<!DOCTYPE html>
<html lang="en">
<title>GBA Tutorials</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="../css/reg_style.css">  <!--Style for displaying registers-->
<link rel="stylesheet" href="../css/flex_2columns.css">  <!--Style for displaying registers-->
<link rel="stylesheet" href="../css/flex_selectors.css">  <!--Style for displaying registers-->
<link rel="stylesheet" href="../css/page_style.css">  <!--Style for displaying page formatting-->
<link rel="stylesheet" href="../css/content.css">  <!--Style for displaying registers-->
<link rel="stylesheet" href="../css/prism.css">
<script src=""></script>
<body>

    <div class="content">

        <div class="nav">
            <a href="../index.html">Home</a>
            <a href="#">Setup</a>
            <a href="#">Basics</a>
            <a href="#">Mode3</a>
            <a href="#">Mode0</a>
            <a href="#">Math Fun</a>
            <a href="#">About</a>
            <a href="#">Contact</a>

        </div>

        <div class="headergroup">
            <p>Vsync</p>
            <img src="../images/GBA128.png" alt="gba" />
        </div>



        <div class="maincontent">
            <div class="intro">
                <p>
                    This section is all about vsyncing which is a good thing.
                </p>
            </div>



            <div class="topic_headers">
                <h1>VBLANK / HBLANK</h1>
            </div>
            <div class="text_img_6040">

                <div class="text_group">
                    <p>
                        The GBA is constantly scanning the screen from left to right and
                        top to bottom drawing any pixel that needs to be drawn (whether it is in VRAM or not).  Let's say you have some object on the screen that you're moving around and
                        so you tell it to move by pressing one of the keys.  If that happens while the scanlines are being drawn, then there's a chance that maybe only half of your
                        character was drawn when you issued the command.  Issuing the command moves your character automatically, so when the scanlines continue drawing your character
                        the second have of your character will have moved while the top half stayed in place because they were already drawn.  This is called screen-tearing and is very
                        undesirable.  The best way to avoid it is to only update positions when the screen is not being drawn.  Remember the screen isn't being drawn only during HBLANK and
                        VBLANK.  VBLANK gives us the most time to update the state of our characters.  Well, how much time do we have until VBLANK is over and the screen starts to draw
                        again?  That's a good question so let's figure it out.
                    </p>

                    <p>
                        The moral of the story is that we need to be able to determine when the VBLANK starts so that we can have the maximum amount of time to update everything we can.
                        That way we can also guarantee that we only update objects once per frame instead of 100 times or some other random number per frame.
                    </p>
                </div>
                <img src="../common/images/gba_screen_scanning.png" alt="gba screen scanning diagram" />
            </div>


            <div class="content_group">
                <h1 class="codeheader">VCOUNT Register</h1>
                <div class="content_row">
                    <div class="table_text">
                        <p>
                            The VCOUNT register is a register whose sole purpose is to keep track which line is currently being scanned.  So it is a fairly simple register.  
                        </p>
                    </div>

                    <div class="table_info">
                        <div class="table_group">
                            <div class="table_header">
                                <p>REG_VCOUNT</p>
                                <p>0x0400:0006</p>
                                <p>0x0000</p>

                            </div>
                            <div class="tables">

                                <table>
                                    <tr class="values">
                                        <th>F</th>
                                        <th>E</th>
                                        <th>D</th>
                                        <th>C</th>
                                    </tr>
                                    <tr>
                                        <td>x</td>
                                        <td>x</td>
                                        <td>x</td>
                                        <td>x</td>
                                    </tr>
                                </table>

                                <table>
                                    <tr class="values">
                                        <th>B</th>
                                        <th>A</th>
                                        <th>9</th>
                                        <th>8</th>
                                    </tr>
                                    <tr>
                                        <td>x</td>
                                        <td>x</td>
                                        <td>x</td>
                                        <td>x</td>
                                    </tr>
                                </table>

                                <table>
                                    <tr class="values">
                                        <th>7</th>
                                        <th>6</th>
                                        <th>5</th>
                                        <th>4</th>
                                    </tr>
                                    <tr>
                                        <td>0</td>
                                        <td>0</td>
                                        <td>0</td>
                                        <td>0</td>
                                    </tr>
                                </table>

                                <table>
                                    <tr class="values">
                                        <th>3</th>
                                        <th>2</th>
                                        <th>1</th>
                                        <th>0</th>
                                    </tr>
                                    <tr>
                                        <td>0</td>
                                        <td>0</td>
                                        <td>0</td>
                                        <td>0</td>
                                    </tr>
                                </table>

                            </div>
                        </div>
                    </div>

                </div><!--content_row-->
            </div><!--content_group-->



            <div class="content_group">
                <h1>main.cpp</h1>
                <div class="content_row">
                    <div class="codetext">
                        <p>
                            Now that we know about the VCOUNT register, we can use it in order to keep track of when VCOUNT starts.  We know that the VCOUNT starts after line 160 is scanned
                            because that's the height of the screen.  In order to guarantee that we start at the start of VCOUNT we need to do 2 things.  
                        </p>


                    </div>


                    <div class="code">
                        <h3>main.cpp</h3>
                        <pre>
                        <code class="language-cpp">
#define REG_VCOUNT      *(volatile unsigned short*)0x04000006

int main()
{
    REG_DISP = 0x0403;

    while(1)
    {
        while(REG_VCOUNT >= 160);
		while(REG_VCOUNT < 160);
    }
    return 0;
}     
                            

                            </code>
                      
                        </pre>
                    </div>
                </div>
            </div>



            <div class="topic_headers">
                <h1>Memory</h1>
            </div>
            <div class="text_table_6040">

                <div class="text_group">
                    <p>
                        Let's first talk about the screen on the right.  This may look strange and there may be a few words in there you don't recognize.
                        That's ok, all will be clear before long.  Instead of describing the picture, I'll tell you a few things about the Gameboy Advance, and
                        then you just refer to the picture as I'm explaining them.
                    </p>
                    <p>
                        The Gameboy Advance has a screen with the size of 240 pixels wide and 160 pixels high.  That's a total of 240 x 160 = 38,400 pixels.
                    </p>
                    <p>
                        The first pixel is located in the upper left corner of the screen.  Positive x-direction goes to the right, and positive y-direction goes down.

                    </p>
                    <p>
                        Like most screens, the pixels are drawn to the screen one line at a time.  Each horizontal line is called a scanline and it starts in the
                        upper left corner of the screen which is the first pixel.  That (x, y) location is (0, 0).  Once a scanline reaches the end of the Gameboy Advance
                        screen horizontally, or when x = 240 since the screen is 240 pixels wide, the scanline resets back to x=0, but moves down 1 line.  It then proceeds to
                        scan that line horizontally.  The time it takes for the scanline to reset back to the start of the next line is called the Horizontal Blank or
                        HBLANK for short.  The time it takes to reset is equivalent to the time it takes to scan 68 pixels.
                    </p>
                    <p>
                        Likewise, once the scanline reaches the end of the last line or when (x, y) = (239, 159), the scanline must reset back to the top left corner of the
                        screen.  So the time it takes the scanline to move from the bottom right corner back to the top left corner is equivalent to scanning 68 rows.  This
                        period of time is known as the Vertical Blank or VBLANK for short.  You'll  hear a lot more about HBLANK and VBLANK later, but this is where these
                        terms come from.
                    </p>
                </div>
                <table>
                    <tr>
                        <th>Memory</th>
                        <th>Start</th>
                        <th>Stop</th>
                        <th>Size (KB)</th>

                    </tr>
                    <tr>
                        <td>System ROM</td>
                        <td>0x0000:0000</td>
                        <td>0x0000:3FFF</td>
                        <td>16KB</td>
                    </tr>

                    <tr>
                        <td>EWRAM</td>
                        <td>0x0200:0000</td>
                        <td>0x0203:FFFF</td>
                        <td>256KB</td>
                    </tr>

                    <tr>
                        <td>IWRAM</td>
                        <td>0x0300:0000</td>
                        <td>0x0300:7FFF</td>
                        <td>32KB</td>
                    </tr>

                    <tr>
                        <td>IORAM</td>
                        <td>0x0400:0000</td>
                        <td>0x0400:03FF</td>
                        <td>1KB</td>
                    </tr>

                    <tr>
                        <td>PALRAM</td>
                        <td>0x0500:0000</td>
                        <td>0x0500:03FF</td>
                        <td>1KB</td>
                    </tr>

                    <tr>
                        <td>VRAM</td>
                        <td>0x0600:0000</td>
                        <td>0x0601:7FFF</td>
                        <td>96KB</td>
                    </tr>

                    <tr>
                        <td>OAM</td>
                        <td>0x0700:0000</td>
                        <td>0x0700:03FF</td>
                        <td>1KB</td>
                    </tr>

                    <tr>
                        <td>PAKRAM</td>
                        <td>0x0800:0000</td>
                        <td>variable</td>
                        <td>16KB</td>
                    </tr>

                    <tr>
                        <td>CARTRAM</td>
                        <td>0x0E00:0000</td>
                        <td>variable</td>
                        <td>16KB</td>
                    </tr>
                </table>
            </div>





            <div class="color_flex">
                <div class="pgroup">
                    <p>
                        Take a look at the following bit layout.  We can see that there are 16 bits here or 2 bytes.  The Gameboy Advance uses 2 bytes to store color information.
                        However, out of those 16 bits it really only uses 15 bits.  That's why the last bit you see has an x, that bit is never used and is always 0.
                        The reason it isn't used is because the Gameboy Advance stores colors in RGB format where each color channel uses 5 bits.  So you use 5 bits for red,
                        5 bits for green, and 5 bits for blue.  Which bits correspond to which color is shown in the diagram.

                    </p>
                    <p>
                        This means that each color channel can have 32 different values (0-31) since 2<sup>5</sup> = 32.  Also, since we only use 15 bits to represent a color, we
                        can only have 2<sup>15</sup> = 32,768 colors represented on the Gameboy Advance.  Like I said before, not a ton of colors, but good enough.

                    </p>
                    <p>
                        So let's say we wanted to make pure red, green, and blue colors.  How would we do that?  Look at the diagrams below to see how.
                    </p>
                </div>



                <div class="color_group">
                    <div class="color_header">
                        <p>15 Bits</p>
                        <p>GBA Color Template</p>
                        <p>0x0000</p>

                    </div>
                    <div class="color_table">

                        <table>
                            <tr class="values">
                                <th>F</th>
                                <th class="blue">E</th>
                                <th class="blue">D</th>
                                <th class="blue">C</th>
                            </tr>
                            <tr>
                                <td>x</td>
                                <td>b</td>
                                <td>b</td>
                                <td>b</td>
                            </tr>
                        </table>

                        <table>
                            <tr class="values">
                                <th class="blue">B</th>
                                <th class="blue">A</th>
                                <th class="green">9</th>
                                <th class="green">8</th>
                            </tr>
                            <tr>
                                <td>b</td>
                                <td>b</td>
                                <td>g</td>
                                <td>g</td>
                            </tr>
                        </table>

                        <table>
                            <tr class="values">
                                <th class="green">7</th>
                                <th class="green">6</th>
                                <th class="green">5</th>
                                <th class="red">4</th>
                            </tr>
                            <tr>
                                <td>g</td>
                                <td>g</td>
                                <td>g</td>
                                <td>r</td>
                            </tr>
                        </table>

                        <table>
                            <tr class="values">
                                <th class="red">3</th>
                                <th class="red">2</th>
                                <th class="red">1</th>
                                <th class="red">0</th>
                            </tr>
                            <tr>
                                <td>r</td>
                                <td>r</td>
                                <td>r</td>
                                <td>r</td>
                            </tr>
                        </table>

                    </div>
                </div>


            </div>


            <div class="color_3columns">
                <div class="color_group_3column">
                    <div class="color_header" style="background: red">
                        <p>RED</p>
                        <p>GBA Color</p>
                        <p>0x001F</p>

                    </div>
                    <div class="color_table">

                        <table>
                            <tr class="values">
                                <th>F</th>
                                <th class="blue">E</th>
                                <th class="blue">D</th>
                                <th class="blue">C</th>
                            </tr>
                            <tr>
                                <td>0</td>
                                <td>0</td>
                                <td>0</td>
                                <td>0</td>
                            </tr>
                        </table>

                        <table>
                            <tr class="values">
                                <th class="blue">B</th>
                                <th class="blue">A</th>
                                <th class="green">9</th>
                                <th class="green">8</th>
                            </tr>
                            <tr>
                                <td>0</td>
                                <td>0</td>
                                <td>0</td>
                                <td>0</td>
                            </tr>
                        </table>

                        <table>
                            <tr class="values">
                                <th class="green">7</th>
                                <th class="green">6</th>
                                <th class="green">5</th>
                                <th class="red">4</th>
                            </tr>
                            <tr>
                                <td>0</td>
                                <td>0</td>
                                <td>0</td>
                                <td>1</td>
                            </tr>
                        </table>

                        <table>
                            <tr class="values">
                                <th class="red">3</th>
                                <th class="red">2</th>
                                <th class="red">1</th>
                                <th class="red">0</th>
                            </tr>
                            <tr>
                                <td>1</td>
                                <td>1</td>
                                <td>1</td>
                                <td>1</td>
                            </tr>
                        </table>

                    </div>
                </div>

                <div class="color_group_3column">
                    <div class="color_header" style="background:green">
                        <p>Green</p>
                        <p>GBA Color</p>
                        <p>0x03E0</p>

                    </div>
                    <div class="color_table">

                        <table>
                            <tr class="values">
                                <th>F</th>
                                <th class="blue">E</th>
                                <th class="blue">D</th>
                                <th class="blue">C</th>
                            </tr>
                            <tr>
                                <td>0</td>
                                <td>0</td>
                                <td>0</td>
                                <td>0</td>
                            </tr>
                        </table>

                        <table>
                            <tr class="values">
                                <th class="blue">B</th>
                                <th class="blue">A</th>
                                <th class="green">9</th>
                                <th class="green">8</th>
                            </tr>
                            <tr>
                                <td>0</td>
                                <td>0</td>
                                <td>1</td>
                                <td>1</td>
                            </tr>
                        </table>

                        <table>
                            <tr class="values">
                                <th class="green">7</th>
                                <th class="green">6</th>
                                <th class="green">5</th>
                                <th class="red">4</th>
                            </tr>
                            <tr>
                                <td>1</td>
                                <td>1</td>
                                <td>1</td>
                                <td>0</td>
                            </tr>
                        </table>

                        <table>
                            <tr class="values">
                                <th class="red">3</th>
                                <th class="red">2</th>
                                <th class="red">1</th>
                                <th class="red">0</th>
                            </tr>
                            <tr>
                                <td>0</td>
                                <td>0</td>
                                <td>0</td>
                                <td>0</td>
                            </tr>
                        </table>

                    </div>
                </div>

                <div class="color_group_3column">
                    <div class="color_header" style="background: blue">
                        <p>Blue</p>
                        <p>GBA Color</p>
                        <p>0x7C00</p>

                    </div>
                    <div class="color_table">

                        <table>
                            <tr class="values">
                                <th>F</th>
                                <th class="blue">E</th>
                                <th class="blue">D</th>
                                <th class="blue">C</th>
                            </tr>
                            <tr>
                                <td>0</td>
                                <td>1</td>
                                <td>1</td>
                                <td>1</td>
                            </tr>
                        </table>

                        <table>
                            <tr class="values">
                                <th class="blue">B</th>
                                <th class="blue">A</th>
                                <th class="green">9</th>
                                <th class="green">8</th>
                            </tr>
                            <tr>
                                <td>1</td>
                                <td>1</td>
                                <td>0</td>
                                <td>0</td>
                            </tr>
                        </table>

                        <table>
                            <tr class="values">
                                <th class="green">7</th>
                                <th class="green">6</th>
                                <th class="green">5</th>
                                <th class="red">4</th>
                            </tr>
                            <tr>
                                <td>0</td>
                                <td>0</td>
                                <td>0</td>
                                <td>0</td>
                            </tr>
                        </table>

                        <table>
                            <tr class="values">
                                <th class="red">3</th>
                                <th class="red">2</th>
                                <th class="red">1</th>
                                <th class="red">0</th>
                            </tr>
                            <tr>
                                <td>0</td>
                                <td>0</td>
                                <td>0</td>
                                <td>0</td>
                            </tr>
                        </table>

                    </div>
                </div>
            </div>

            <p>
                Look how we defined the three colors above.  We defined red, green, and blue.  Notice that red is equal to 0x001F, green is equal to 0x03E0, and blue
                is equal to 0x7C00 in hexidecimal.  These are the values that we store in the Gameboy Advance, either in the palette memory or directly into VRAM.
            </p>
            <p>
                Check out the color calculator below, just set the bits you want to set and see what color it represents.  Fun!
            </p>


            <div class="reg_group">
                <div class="reg_header">
                    <p>REG_DISP</p>
                    <p>0x0400:0000</p>
                    <p>0x0403</p>

                </div>
                <div class="reg_table">

                    <table>
                        <tr class="values">
                            <th>F</th>
                            <th>E</th>
                            <th>D</th>
                            <th>C</th>
                        </tr>
                        <tr>
                            <td>0</td>
                            <td>0</td>
                            <td>0</td>
                            <td>0</td>
                        </tr>
                    </table>

                    <table>
                        <tr class="values">
                            <th>B</th>
                            <th>A</th>
                            <th>9</th>
                            <th>8</th>
                        </tr>
                        <tr>
                            <td>0</td>
                            <td>1</td>
                            <td>0</td>
                            <td>0</td>
                        </tr>
                    </table>

                    <table>
                        <tr class="values">
                            <th>7</th>
                            <th>6</th>
                            <th>5</th>
                            <th>4</th>
                        </tr>
                        <tr>
                            <td>0</td>
                            <td>0</td>
                            <td>0</td>
                            <td>0</td>
                        </tr>
                    </table>

                    <table>
                        <tr class="values">
                            <th>3</th>
                            <th>2</th>
                            <th>1</th>
                            <th>0</th>
                        </tr>
                        <tr>
                            <td>0</td>
                            <td>0</td>
                            <td>1</td>
                            <td>1</td>
                        </tr>
                    </table>

                </div>
            </div>



            <p>
                Naturally, you probably don't want to type in the hex values directly into your code.  I mean, you can, there's really nothing wrong with that.  The
                Gameboy Advance doesn't care how you type it in.  But to make it easier for us it might be easier to define colors in RGB format and have a function
                that converts it to its hex value for you.  Unless you're a wiz with hex values I would suggest that you write a simple function to do all the tedious
                work, just as long as it returns a 2 byte value.
            </p>



            <div class="conclusion">
                <h1>Conclusion</h1>
                <p>
                    If you can successfully compile this simple project, then you should be good to go with the rest of the projects on this site.

                </p>
            </div>









        </div><!--maincontent-->
    </div><!--content-->
    <script src="../../js/prism.js"></script>
</body>
</html>
