<!DOCTYPE html>
<html lang="en">
<title>GBA Tutorials</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<!--<link rel="stylesheet" href="../css/reg_style.css">-->  <!--Style for displaying registers-->
<link rel="stylesheet" href="../css/flex_selectors.css">  <!--Style for displaying registers-->
<link rel="stylesheet" href="../css/content.css">  <!--Style for displaying registers-->
<link rel="stylesheet" href="../css/page_style.css">  <!--Style for displaying registers-->
<link rel="stylesheet" href="../css/prism.css">
<script src=""></script>
<body>

    <div class="content">

        <div class="nav">
            <a href="../index.html">Home</a>
            <a href="../common/setup.html">Setup</a>
            <a href="../common/basics.html">Basics</a>
            <a href="#">Mode3</a>
            <a href="#">Mode0</a>
            <a href="#">Math Fun</a>
            <a href="#">About</a>
            <a href="#">Contact</a>

        </div>

        <div class="headergroup">
            <p>Keys / Buttons</p>
            <img src="../images/GBA128.png" alt="gba" />
        </div>



        <div class="maincontent">
            <div class="intro_group">
                <div class="intro_text">
                    <p>
                        The Gameboy Advance has 10 buttons or keys.  Check out the image on the right and you'll see all of the buttons colored red.  Before you look at that and tell me that
                        I'm wrong and that there are only 7 buttons, keep in mind that the directional pad has 4 buttons.
                    </p>
                    <p>
                        These are all of the buttons on the Gameboy Advance:
                    </p>
                    <ol>
                        <li>UP</li>
                        <li>DOWN</li>
                        <li>LEFT</li>
                        <li>RIGHT</li>
                        <li>B</li>
                        <li>A</li>
                        <li>L</li>
                        <li>R</li>
                        <li>START</li>
                        <li>SELECT</li>
                    </ol>

                    <p>
                        This section is all about what we have to do in order to use the buttons in the most common ways.
                    </p>
                </div>
                <div class="intro_image">
                    <img src="images/GBA_outline_keys.png" alt="test image">
                </div>
            </div>


            <div class="content_group">
                <h1>Setup</h1>
                <div class="content_row">
                    <div class="text">
                        <p>
                            If you haven't already open up the Programmer's Notepad or whatever editor you're using and create a new empty project.
                            This will usually be the first task in all of our projects, so that's why I've created a page that explains how to create an empty project and get it ready for our code.
                            If you need help setting the project up, look at the sidebar on the right.
                        </p>
                    </div>


                    <div class="info">
                        <h3>TIP</h3>

                        <br />
                        <p>
                            Creating an empty project is the first step.
                        </p>
                        <br /><br />
                        <a href="../common/skeleton.html">Go</a>
                        <br /><br />
                    </div>
                </div>
            </div>


            <div class="content_group">
                <h1 class="codeheader">Keypad Register</h1>
                <div class="content_row">
                    <div class="table_text">
                        <p>
                            There's a register that keeps track of which keys are being pressed.  This register has the memory location of 0x04000130 and is of course 2 bytes wide and is
                            read-only.  That makes sense since there's really no reason you would need to write to it.
                            Which bits correspond to which buttons are shown on the right.  What's interesting about this register is all of the bits that correspond to the keys
                            normally have a value of 1 instead of 0.  You would think that all of the bits would be 0 if no keys are being pressed, and then when a certain key is
                            pressed that bit would turn to a value of 1.  It's actually the opposite.  The bits are set to have a value of 1 and when a key is pressed, that bit
                            changes its value to 0.  So when no keys are being pressed this register has a value of 0x03FF.
                        </p>

                        <p>
                            So determining when a key is being pressed is pretty easy, we just need to watch when that keys bit turns to 0.  Lets see how all of that works next.
                        </p>
                    </div>

                    <div class="table_info">
                        <div class="table_group">
                            <div class="table_header">
                                <p>REG_KEYS</p>
                                <p>0x0400:0130</p>
                                <p>0x03FF</p>

                            </div>
                            <div class="tables">

                                <table>
                                    <tr class="values">
                                        <th>F</th>
                                        <th>E</th>
                                        <th>D</th>
                                        <th>C</th>
                                    </tr>
                                    <tr>
                                        <td>0</td>
                                        <td>0</td>
                                        <td>0</td>
                                        <td>0</td>
                                    </tr>
                                </table>

                                <table>
                                    <tr class="values">
                                        <th>B</th>
                                        <th>A</th>
                                        <th>9</th>
                                        <th>8</th>
                                    </tr>
                                    <tr>
                                        <td>0</td>
                                        <td>0</td>
                                        <td>L</td>
                                        <td>R</td>
                                    </tr>
                                </table>

                                <table>
                                    <tr class="values">
                                        <th>7</th>
                                        <th>6</th>
                                        <th>5</th>
                                        <th>4</th>
                                    </tr>
                                    <tr>
                                        <td>Down</td>
                                        <td>Up</td>
                                        <td>Left</td>
                                        <td>Right</td>
                                    </tr>
                                </table>

                                <table>
                                    <tr class="values">
                                        <th>3</th>
                                        <th>2</th>
                                        <th>1</th>
                                        <th>0</th>
                                    </tr>
                                    <tr>
                                        <td>Start</td>
                                        <td>Select</td>
                                        <td>B</td>
                                        <td>A</td>
                                    </tr>
                                </table>

                            </div>
                        </div>
                    </div>

                </div><!--content_row-->
            </div><!--content_group-->





            <div class="content_group">
                <h1>Basic Implementation</h1>
                <div class="content_row">
                    <div class="codetext">
                        <p>
                            So how do we actually check for the key presses and what does that code actually look like?  The code you see to the right is not stand-alone code.  That means
                            that you need to include this code somewhere in your project, running this code by itself won't do anything interesting.
                        </p>
                        <p>
                            We first need to have a pointer that points to the register that handles the key presses.  Make sure it is set as volatile and that it is dereferenced.  We're going to
                            be constantly reading from this memory address.  We can't write to it because it is set as read-only.
                        </p>
                        <p>
                            We also defined a 2 byte value called UP.  I'm doing this because in this example we are just checking when the user presses the up key on the keypad.  If you look
                            at the memory layout above you'll see that the UP key corresponds to this value.
                        </p>
                        <p>
                            Now if we look in the while loop, you'll see how I'm checking for this particular key press.  First off I flip the bits on our register.  That's because it just makes life
                            easier when we correspond a "1" to a keypress and a "0" to no key press.  The GBA does it opposite, look at the explanation above.  We then do a bitwise AND operation on
                            the UP value.  If the UP key is not being pressed, then this will result in a 0 or false.  If the UP key is being pressed then this will result in a non-zero value or true.
                            When the check passes, when the UP key is being pressed, then we can execute the code.
                        </p>
                        <p>
                            This will work for things like moving a character around the screen.  But it won't work if you just need to detect a single key press.  For example, if you need to pause
                            the game by pressing the Start button, then when you press the start button you only want to register 1 press.  In other words, you only want to execute the pause code once
                            and not continuously.  So we actually need to have two different kinds of key presses:  continuous and discrete presses.  The code here works for continuous, but we'll
                            need to do a bit more for the discrete presses to work.
                        </p>
                    </div>


                    <div class="code">
                        <h3>main.cpp</h3>
                        <pre>
                        <code class="language-cpp">
#define REG_KEYS    *(volatile unsigned short*)0x04000130
#define UP          0x0040

int main()
{
    *(volatile unsigned short*)0x04000000 = 0x0403;
 
    while(1)
    {
        if(~REG_KEYS &amp; UP)
        {
            //The UP key is currently being pressed.
        }
    }
    return 0;
}                  
                            </code>
                      
                        </pre>
                    </div>
                </div>
            </div>



            <div class="content_group">
                <h1 class="codeheader">Visual Explanation of Basic Implementation</h1>
                <div class="content_row">
                    <div class="table_text">
                        <p>
                            Take a look at these bits.  The first one is the default state of the key register (0x0400:0130).  The second line is just the first line with all of the bits
                            inverted so that the default state has the keys zeroed out when they are not being pressed.  The last one respresents the UP Key.  Notice that there is only 1 bit
                            set which is in the UP key position.  Take a look at the chart at the top for the bit positions of all of the keys.
                        </p>
                        <p>
                            Remember the code above where we checked for the UP key being pressed with (~REG_KEYS &amp; UP)?  If you look at the middle 2 lines at the right you'll see that if
                            the UP key is not being pressed then this expression results in a 0 value.
                        </p>
                        <p>
                            The last line shows the inverted register when the UP key is being pressed.  If you look at the last 2 lines you should see that now this expression will result in
                            something other than 0.  Also notice that it doesn't matter if other keys are being pressed since we are only interested in the UP key all of the other keys
                            will get zeroed out anyways.
                        </p>
                    </div>

                    <div class="table_info">
                        <div class="table_group">

                            <div>
                                <p>REG_KEY: 0x03FF</p>
                                <div class="table_row">

                                    <table>

                                        <tr>
                                            <td>0</td>
                                            <td>0</td>
                                            <td>0</td>
                                            <td>0</td>
                                        </tr>
                                    </table>

                                    <table>

                                        <tr>
                                            <td>0</td>
                                            <td>0</td>
                                            <td>1</td>
                                            <td>1</td>
                                        </tr>
                                    </table>

                                    <table>

                                        <tr>
                                            <td>1</td>
                                            <td>1</td>
                                            <td>1</td>
                                            <td>1</td>
                                        </tr>
                                    </table>

                                    <table>

                                        <tr>
                                            <td>1</td>
                                            <td>1</td>
                                            <td>1</td>
                                            <td>1</td>
                                        </tr>
                                    </table>

                                </div>

                                <p>~REG_KEY: 0xFC00</p>
                                <div class="table_row">
                                    <table>
                                        <tr>
                                            <td>1</td>
                                            <td>1</td>
                                            <td>1</td>
                                            <td>1</td>
                                        </tr>
                                    </table>

                                    <table>

                                        <tr>
                                            <td>1</td>
                                            <td>1</td>
                                            <td>0</td>
                                            <td>0</td>
                                        </tr>
                                    </table>

                                    <table>

                                        <tr>
                                            <td>0</td>
                                            <td>0</td>
                                            <td>0</td>
                                            <td>0</td>
                                        </tr>
                                    </table>

                                    <table>

                                        <tr>
                                            <td>0</td>
                                            <td>0</td>
                                            <td>0</td>
                                            <td>0</td>
                                        </tr>
                                    </table>

                                </div>

                                <p>UP KEY: 0x0040</p>
                                <div class="table_row">
                                    <table>
                                        <tr>
                                            <td>0</td>
                                            <td>0</td>
                                            <td>0</td>
                                            <td>0</td>
                                        </tr>
                                    </table>

                                    <table>

                                        <tr>
                                            <td>0</td>
                                            <td>0</td>
                                            <td>0</td>
                                            <td>0</td>
                                        </tr>
                                    </table>

                                    <table>

                                        <tr>
                                            <td>0</td>
                                            <td>1</td>
                                            <td>0</td>
                                            <td>0</td>
                                        </tr>
                                    </table>

                                    <table>

                                        <tr>
                                            <td>0</td>
                                            <td>0</td>
                                            <td>0</td>
                                            <td>0</td>
                                        </tr>
                                    </table>

                                </div>

                                <p>~REG_KEY: 0xFC40 (UP Key pressed)</p>
                                <div class="table_row">
                                    <table>
                                        <tr>
                                            <td>1</td>
                                            <td>1</td>
                                            <td>1</td>
                                            <td>1</td>
                                        </tr>
                                    </table>

                                    <table>

                                        <tr>
                                            <td>1</td>
                                            <td>1</td>
                                            <td>0</td>
                                            <td>0</td>
                                        </tr>
                                    </table>

                                    <table>

                                        <tr>
                                            <td>0</td>
                                            <td>1</td>
                                            <td>0</td>
                                            <td>0</td>
                                        </tr>
                                    </table>

                                    <table>

                                        <tr>
                                            <td>0</td>
                                            <td>0</td>
                                            <td>0</td>
                                            <td>0</td>
                                        </tr>
                                    </table>

                                </div>

                            </div>
                        </div>
                    </div>

                </div><!--content_row-->
            </div><!--content_group-->



            <div class="content_group">
                <h1>Advanced Implementation</h1>
                <div class="content_row">
                    <div class="codetext">
                        <p>
                            Remember that we're also interested in knowing when a key is pressed but not necessarily held down.  That means that we're not just interested in the state of
                            the keys, but their transition states as well.  For example, if we only wanted our character to move 1 pixel with each key press instead of continuously.  In order
                            to have that kind of key press we need to keep track of not only the current state of the keys, but also their previous state.
                        </p>
                        <p>
                            I added 2 new variables called curr and prev for current and previous states respectively.  In the while loop I have 2 different key presses defined:  a continuous 
                            press and a one-time key press.  As you can see I need all three variables to determine the state of the key press.  
                        </p>
                    </div>


                    <div class="code">
                        <h3>main.cpp</h3>
                        <pre>
                        <code class="language-cpp">
#define REG_KEYS    *(volatile unsigned short*)0x04000130
#define UP          0x0040

int main()
{
    *(volatile unsigned short*)0x04000000 = 0x0403;

    volatile unsigned short curr = ~REG_KEYS;
    volatile unsigned short prev = ~REG_KEYS;
 
    while(1)
    {
        if((curr &amp; prev) &amp; UP)
        {
            //The UP key is currently being pressed.
        }

        if((curr &amp; ~prev) &amp; UP)
        {
            //The UP key was just pressed 
        }

        if((~curr &amp; prev) &amp; UP)
        {
            //The UP key was just released
        }

        prev = curr;
        curr = ~REG_KEYS;
    }
    return 0;
}                  
                            </code>
                      
                        </pre>
                    </div>
                </div>
            </div>



            <div class="content_group">
                <h1 class="codeheader">Visual Explanation of Advanced Implementation</h1>
                <div class="content_row">
                    <div class="table_text">
                        <p>
                            The first set of 4 rows shows the state everything is in when the UP key is
                            initially pressed down.  The current state shows that the UP key is being pressed
                            and the previous state shows that it was not pressed previously.  If you do a bitwise
                            AND operation on the current state, the inverse of the previous state (~prev), and
                            the UP key you'll see that you get a non-zero result.
                                
                        </p>
                        <p>
                            In the second set of 4 rows we're now in the state where the UP key is still being
                            held down.  So here the current state and the previous state are the same in terms of
                            the UP key being pressed.  Now if you take the bitwise AND operation on the current
                            state, the inverse of the previous state (~prev), and the UP key you'll get a result
                            of 0.  You'll continue to get 0 while holding the key down.  That is until you release
                            the key and press it down again.
                        </p>
                        <p>
                            Also notice that if you take the bitwise AND operation on the current state, previous state,
                            and the UP key in second set you'll get a non-zero result which is what we want if we
                            want to determine if the key is being held down.
                        </p>
                        <p>
                            Finally, you can determine when a player has released a key by using the same three
                            variables and inverting the current state rather than the previous state.  
                        </p>
                    </div>

                    <div class="table_info">
                        <div class="table_group">

                            <div>
                                <p>UP key initially pressed</p>
                                <p>Current State</p>
                                <div class="table_row">
                                    <table>
                                        <tr>
                                            <td>1</td>
                                            <td>1</td>
                                            <td>1</td>
                                            <td>1</td>
                                        </tr>
                                    </table>

                                    <table>

                                        <tr>
                                            <td>1</td>
                                            <td>1</td>
                                            <td>0</td>
                                            <td>0</td>
                                        </tr>
                                    </table>

                                    <table>

                                        <tr>
                                            <td>0</td>
                                            <td>1</td>
                                            <td>0</td>
                                            <td>0</td>
                                        </tr>
                                    </table>

                                    <table>

                                        <tr>
                                            <td>0</td>
                                            <td>0</td>
                                            <td>0</td>
                                            <td>0</td>
                                        </tr>
                                    </table>

                                </div>


                                <p>Previous State</p>
                                <div class="table_row">
                                    <table>
                                        <tr>
                                            <td>1</td>
                                            <td>1</td>
                                            <td>1</td>
                                            <td>1</td>
                                        </tr>
                                    </table>

                                    <table>

                                        <tr>
                                            <td>1</td>
                                            <td>1</td>
                                            <td>0</td>
                                            <td>0</td>
                                        </tr>
                                    </table>

                                    <table>

                                        <tr>
                                            <td>0</td>
                                            <td>0</td>
                                            <td>0</td>
                                            <td>0</td>
                                        </tr>
                                    </table>

                                    <table>

                                        <tr>
                                            <td>0</td>
                                            <td>0</td>
                                            <td>0</td>
                                            <td>0</td>
                                        </tr>
                                    </table>

                                </div>

                                <p>~Previous State</p>
                                <div class="table_row">
                                    <table>
                                        <tr>
                                            <td>0</td>
                                            <td>0</td>
                                            <td>0</td>
                                            <td>0</td>
                                        </tr>
                                    </table>

                                    <table>

                                        <tr>
                                            <td>0</td>
                                            <td>0</td>
                                            <td>1</td>
                                            <td>1</td>
                                        </tr>
                                    </table>

                                    <table>

                                        <tr>
                                            <td>1</td>
                                            <td>1</td>
                                            <td>1</td>
                                            <td>1</td>
                                        </tr>
                                    </table>

                                    <table>

                                        <tr>
                                            <td>1</td>
                                            <td>1</td>
                                            <td>1</td>
                                            <td>1</td>
                                        </tr>
                                    </table>

                                </div>

                                <p>UP KEY</p>
                                <div class="table_row">
                                    <table>
                                        <tr>
                                            <td>0</td>
                                            <td>0</td>
                                            <td>0</td>
                                            <td>0</td>
                                        </tr>
                                    </table>

                                    <table>

                                        <tr>
                                            <td>0</td>
                                            <td>0</td>
                                            <td>0</td>
                                            <td>0</td>
                                        </tr>
                                    </table>

                                    <table>

                                        <tr>
                                            <td>0</td>
                                            <td>1</td>
                                            <td>0</td>
                                            <td>0</td>
                                        </tr>
                                    </table>

                                    <table>

                                        <tr>
                                            <td>0</td>
                                            <td>0</td>
                                            <td>0</td>
                                            <td>0</td>
                                        </tr>
                                    </table>

                                </div>

                                <hr style="margin: 20px 0;"/>
                                <p>UP Key still being pressed</p>

                                <p>Current State</p>
                                <div class="table_row">
                                    <table>
                                        <tr>
                                            <td>1</td>
                                            <td>1</td>
                                            <td>1</td>
                                            <td>1</td>
                                        </tr>
                                    </table>

                                    <table>

                                        <tr>
                                            <td>1</td>
                                            <td>1</td>
                                            <td>0</td>
                                            <td>0</td>
                                        </tr>
                                    </table>

                                    <table>

                                        <tr>
                                            <td>0</td>
                                            <td>1</td>
                                            <td>0</td>
                                            <td>0</td>
                                        </tr>
                                    </table>

                                    <table>

                                        <tr>
                                            <td>0</td>
                                            <td>0</td>
                                            <td>0</td>
                                            <td>0</td>
                                        </tr>
                                    </table>

                                </div>


                                <p>Previous State</p>
                                <div class="table_row">
                                    <table>
                                        <tr>
                                            <td>1</td>
                                            <td>1</td>
                                            <td>1</td>
                                            <td>1</td>
                                        </tr>
                                    </table>

                                    <table>

                                        <tr>
                                            <td>1</td>
                                            <td>1</td>
                                            <td>0</td>
                                            <td>0</td>
                                        </tr>
                                    </table>

                                    <table>

                                        <tr>
                                            <td>0</td>
                                            <td>1</td>
                                            <td>0</td>
                                            <td>0</td>
                                        </tr>
                                    </table>

                                    <table>

                                        <tr>
                                            <td>0</td>
                                            <td>0</td>
                                            <td>0</td>
                                            <td>0</td>
                                        </tr>
                                    </table>

                                </div>

                                <p>~Previous State</p>
                                <div class="table_row">
                                    <table>
                                        <tr>
                                            <td>0</td>
                                            <td>0</td>
                                            <td>0</td>
                                            <td>0</td>
                                        </tr>
                                    </table>

                                    <table>

                                        <tr>
                                            <td>0</td>
                                            <td>0</td>
                                            <td>1</td>
                                            <td>1</td>
                                        </tr>
                                    </table>

                                    <table>

                                        <tr>
                                            <td>1</td>
                                            <td>0</td>
                                            <td>1</td>
                                            <td>1</td>
                                        </tr>
                                    </table>

                                    <table>

                                        <tr>
                                            <td>1</td>
                                            <td>1</td>
                                            <td>1</td>
                                            <td>1</td>
                                        </tr>
                                    </table>

                                </div>

                                <p>UP KEY</p>
                                <div class="table_row">
                                    <table>
                                        <tr>
                                            <td>0</td>
                                            <td>0</td>
                                            <td>0</td>
                                            <td>0</td>
                                        </tr>
                                    </table>

                                    <table>

                                        <tr>
                                            <td>0</td>
                                            <td>0</td>
                                            <td>0</td>
                                            <td>0</td>
                                        </tr>
                                    </table>

                                    <table>

                                        <tr>
                                            <td>0</td>
                                            <td>1</td>
                                            <td>0</td>
                                            <td>0</td>
                                        </tr>
                                    </table>

                                    <table>

                                        <tr>
                                            <td>0</td>
                                            <td>0</td>
                                            <td>0</td>
                                            <td>0</td>
                                        </tr>
                                    </table>

                                </div>

                            </div>
                        </div>
                    </div>

                </div><!--content_row-->
            </div><!--content_group-->




            




            


            <div class="conclusion">
                <h1>Conclusion</h1>
                <p>
                    You can implement the code here into your project whenever you need to control something
                    with key presses, which will be always.  I don't know how else you would control your game
                    without using the keys, so this is a very important section.  I guess there are some games that
                    have accelerometers built in and you can control a game that way, but those have to be on the
                    game cartridge and are definitely not standard.


                </p>
            </div>














        </div><!--maincontent-->
    </div><!--content-->
    <script src="../js/prism.js"></script>
</body>
</html>
